var AJAX=function(){function a(){this.x=new XMLHttpRequest}return a.prototype.send=function(a,b,c,d,e,f){void 0===e&&(e=!0),void 0===f&&(f=[]);var g=this;if(this.x.open(c,a,e),this.x.onreadystatechange=function(){4==g.x.readyState&&b(this.responseText)},"POST"==c&&this.x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),void 0!==f)for(var h=0;h<f.length;h++){var i=f[h];for(var j in i)i.hasOwnProperty(j)&&this.x.setRequestHeader(j,i[j])}this.x.send(d)},a.prototype.get=function(a,b,c,d){void 0===d&&(d=!0);var e=[];for(var f in b)e.push(encodeURIComponent(f)+"="+encodeURIComponent(b[f]));this.send(a+"?"+e.join("&"),c,"GET",null,d,void 0!==b.headers?b.headers:null)},a.prototype.post=function(a,b,c,d){void 0===d&&(d=!0);var e=[];for(var f in b)e.push(encodeURIComponent(f)+"="+encodeURIComponent(b[f]));this.send(a,c,"POST",e.join("&"),d)},a}(),Eureka=function(){function a(a){this.opts=a,this._model=new EurekaModel(a),this._view=new EurekaView,this._controller=new EurekaController({model:this._model,view:this._view}),this._model.setController(this._controller),this._view.setController(this._controller),this._view.init(),this._view.paint(),this._controller.init(),(void 0!==this._model.getCurrentDirectory()||void 0!==this._model.getCurrentMediaSource())&&this.fetch()}return a.prototype.fetch=function(){this._model.getDebug()&&console.log("fetch"),this._model.setCurrentDirectory(this._model.getCurrentDirectory()),this._model.setCurrentMediaSource(this._model.getCurrentMediaSource())},a}(),EurekaMediaSource=function(){function a(a){this.opts=a,this._id="",this._title="",void 0!==a.id&&(this._id=a.id),void 0!==a.title&&(this._title=a.title)}return a.prototype.getID=function(){return this._id},a.prototype.setID=function(a){this._id=a},a.prototype.getTitle=function(){return this._title},a.prototype.setTitle=function(a){this._title=a},a.prototype.toString=function(){return this.getID()},a}(),EurekaModel=function(){function a(a){this._uid="media-browser_0",this._sources=[],this._navTreeHidden=!1,this._useLocalStorage=!0,this._currentDirectory="",this._currentView="view-a",this._locale="en-US",this._selected="",this._editable=!0,this._headers=[],this._debug=!1,this._directoryRequestURL="",this._listSourceRequestURL="",this._listSourcesRequestURL="",this.getXHRHeaders=function(){return this._headers},void 0!==a.uid&&(this._uid=a.uid),void 0!==a.editable&&(this._editable=a.editable),void 0!==a.locale&&(this._locale=a.locale),void 0!==a.mediaSource&&(this._mediaSource=a.mediaSource),void 0!==a.currentDirectory&&(this._currentDirectory=a.currentDirectory),void 0!==a.headers&&(this._headers=a.headers),void 0!==a.navTreeHidden&&(this._navTreeHidden=a.navTreeHidden),void 0!==a.useLocalStorage&&(this._useLocalStorage=a.useLocalStorage),void 0!==a.currentView&&(this._currentView=a.currentView),void 0!==a.selected&&(this._selected=a.selected),void 0!==a.directoryRequestURL&&(this._directoryRequestURL=a.directoryRequestURL),void 0!==a.listSourceRequestURL&&(this._listSourceRequestURL=a.listSourceRequestURL),void 0!==a.listSourcesRequestURL&&(this._listSourcesRequestURL=a.listSourcesRequestURL),a.debug===!0&&(this._debug=a.debug),this._useLocalStorage&&(this.getLocalStorage("currentMediaSource")&&(this._mediaSource=this.getLocalStorage("currentMediaSource")),this.getLocalStorage("navTreeHidden")&&(this._navTreeHidden="true"==this.getLocalStorage("navTreeHidden")?!0:!1),this.getLocalStorage("currentDirectory")&&(this._currentDirectory=this.getLocalStorage("currentDirectory")),this.getLocalStorage("currentView")&&(this._currentView=this.getLocalStorage("currentView")))}return a.prototype.getLocalStorage=function(a){return void 0!==localStorage.getItem(a)&&"undefined"!==localStorage.getItem(a)?localStorage.getItem(a):!1},a.prototype.getDebug=function(){return this._debug},a.prototype.setDebug=function(a){this._debug=a},a.prototype.getUID=function(){return this._uid},a.prototype.getSources=function(){return this._sources},a.prototype.getEditable=function(){return this._editable},a.prototype.getMediaSourceDTOByID=function(a){for(var b=this.getSources(),c=0;c<b.length;c++){var d=b[c];if(d.getID()==a)return d}return null},a.prototype.getController=function(){return this._controller},a.prototype.setController=function(a){this._controller=a},a.prototype.getNavTreeHidden=function(){return this._navTreeHidden},a.prototype.setNavTreeHidden=function(a){this._navTreeHidden=a,this._useLocalStorage&&localStorage.setItem("navTreeHidden",a)},a.prototype.setCurrentMediaSource=function(a,b){if(void 0===b&&(b=!0),this.getDebug()&&console.log("setCurrentMediaSource"),this._mediaSource=a,this._useLocalStorage&&localStorage.setItem("currentMediaSource",a),b!==!1){var c=document.createEvent("CustomEvent");c.initCustomEvent("eurekaMediaSourceChange",!0,!0,{currentMediaSource:a}),this.getController().getView().getElement().dispatchEvent(c)}},a.prototype.getCurrentMediaSource=function(){return this._mediaSource},a.prototype.setCurrentDirectory=function(a,b){if(void 0===b&&(b=!0),this._currentDirectory=a,this._useLocalStorage&&localStorage.setItem("currentDirectory",a),b!==!1){this.getDebug()&&console.log("setCurrentDirectory");var c=document.createEvent("CustomEvent");c.initCustomEvent("eurekaCurrentDirectoryChange",!0,!0,{currentDirectory:a}),this.getController().getView().getElement().dispatchEvent(c)}},a.prototype.getCurrentDirectory=function(){return this._currentDirectory},a.prototype.setCurrentView=function(a,b){if(void 0===b&&(b=!0),this._currentView=a,this._useLocalStorage&&localStorage.setItem("currentView",a),b!==!1){var c=document.createEvent("CustomEvent");c.initCustomEvent("eurekaViewChange",!0,!0,{currentView:a}),this.getController().getView().getElement().dispatchEvent(c)}},a.prototype.getCurrentView=function(){return this._currentView},a.prototype.setLocale=function(a){this._locale=a},a.prototype.getLocale=function(){return this._locale},a.prototype.setSources=function(a,b){if(void 0===b&&(b=!0),this.getDebug()&&console.log("setSources"+b),this._sources=a,b!==!1){var c=document.createEvent("CustomEvent");c.initCustomEvent("MediaSourcesListChange",!0,!0,{data:a}),this.getDebug()&&console.log("setSources"),this.getController().getView().getElement().dispatchEvent(c)}},a.prototype.setMediaSourcesData=function(a){this.getDebug()&&console.log("setMediaSourcesData"),a=JSON.parse(a);for(var b=a.results,c=[],d=0;d<b.length;d++){var e=b[d],f=new EurekaMediaSource({id:e.id,title:e.name});c.push(f)}this.setSources(c)},a.prototype.renameFile=function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent("EurekaFileRename",!0,!0,{fileName:a,newFilename:b,cd:this.getController().getModel().getCurrentMediaSource(),cs:this.getController().getModel().getCurrentDirectory(),path:this.getController().getModel().getCurrentDirectory()+a,newPath:this.getController().getModel().getCurrentDirectory()+b}),this.getController().getView().getElement().dispatchEvent(c)},a.prototype.deleteFile=function(a,b){var c=this,d=document.createEvent("CustomEvent");d.initCustomEvent("EurekaUnlink",!0,!0,{data:{filename:b.getAttribute("data-filename"),timestamp:b.getAttribute("data-timestamp"),src:b.querySelector(".image img").getAttribute("src"),dimensions:[b.getAttribute("data-dimensions-w"),b.getAttribute("data-dimensions-h")],filesize:parseInt(b.getAttribute("data-filesize-bytes"))}}),c.getController().getView().getElement().dispatchEvent(d)},a.prototype.setChoosenMediaItem=function(a){function b(a){for(var b=c.getController().getView().getElement().querySelectorAll("tr.eureka__row"),d=0;d<b.length;d++){var e=b[d];if(e.getAttribute("data-filename")==a)return e}return null}var c=this,d=b(a),e=document.createEvent("CustomEvent");e.initCustomEvent("EurekaFoundIt",!0,!0,{data:{filename:a,timestamp:d.getAttribute("data-timestamp"),src:d.querySelector(".image img").getAttribute("src"),dimensions:[d.getAttribute("data-dimensions-w"),d.getAttribute("data-dimensions-h")],filesize:parseInt(d.getAttribute("data-filesize-bytes"))}}),c.getController().getView().getElement().dispatchEvent(e)},a.prototype.getSelected=function(){return this._selected},a.prototype.setSelected=function(a){this._selected=a},a.prototype.getListDirectoryRequestURL=function(){return this._directoryRequestURL},a.prototype.setListDirectoryRequestURL=function(a){this._directoryRequestURL=a},a.prototype.getListSourceRequestURL=function(){return this._listSourceRequestURL},a.prototype.setListSourceRequestURL=function(a){this._listSourceRequestURL=a},a.prototype.getListSourcesRequestURL=function(){return this._listSourcesRequestURL},a.prototype.setListSourcesRequestURL=function(a){this._listSourcesRequestURL=a},a}(),EurekaView=function(){function a(){}return a.prototype.getController=function(){return this._controller},a.prototype.setController=function(a){this._controller=a},a.prototype.getElement=function(){return document.getElementById(this.getController().getModel().getUID())},a.prototype.assignFooterProceedListeners=function(){var a=this;a.getElement().parentNode.querySelector("footer.proceed button.cta").addEventListener("click",function(b){b.preventDefault(),a.getController().getModel().setChoosenMediaItem(a.getController().getModel().getSelected())})},a.prototype.init=function(){function a(){var a=document.getElementById(c.getController().getModel().getUID()+"__pathbrowser_toggle"),b=document.getElementById(a.getAttribute("data-toggle-target"));b.classList.remove("hidden"),c.getElement().querySelector(".browse-select").classList.add("tablet-p-hidden"),c.getController().getModel().setNavTreeHidden(!1);var d=document.getElementById(c.getController().getModel().getUID()+"__pathbrowser_toggle").getElementsByTagName("i")[0];d.classList.remove("fa-toggle-right"),d.classList.remove("icon-toggle-right"),d.classList.add("fa-toggle-left"),d.classList.add("icon-toggle-left"),a.title=a.getAttribute("data-title-close")}function b(){var a=document.getElementById(c.getController().getModel().getUID()+"__pathbrowser_toggle"),b=document.getElementById(a.getAttribute("data-toggle-target"));b.classList.add("hidden"),c.getElement().querySelector(".browse-select").classList.remove("tablet-p-hidden"),c.getController().getModel().setNavTreeHidden(!0);var d=document.getElementById(c.getController().getModel().getUID()+"__pathbrowser_toggle").getElementsByTagName("i")[0];d.classList.add("fa-toggle-right"),d.classList.add("icon-toggle-right"),d.classList.remove("fa-toggle-left"),d.classList.remove("icon-toggle-left"),a.title=a.getAttribute("data-title-open")}var c=this;document.getElementById(c.getController().getModel().getUID()+"__pathbrowser_toggle").addEventListener("click",function(c){var d=document.getElementById(this.getAttribute("data-toggle-target"));c.preventDefault(),d.classList.contains("hidden")?a():b()}),this.assignViewButtonListeners(),this.assignFooterProceedListeners(),this.assignBrowsingSelectOptGroupListeners(),this.assignMediaBrowserOptGroupListeners(),this.assignSelectListeners(),this.assignSortBtnListeners(),this.assignFilterListeners();var d=document.createEvent("Event");d.initEvent("click",!0,!0),c.getElement().querySelector('.eureka__topbar-nav .view-btns a[data-view="'+c.getController().getModel().getCurrentView()+'"]').dispatchEvent(d),this.getController().getModel().getNavTreeHidden()===!0&&b()},a.prototype.assignBrowsingSelectOptGroupListeners=function(){var a=this;a.getController().getModel().getDebug()&&console.log("assignBrowsingSelectOptGroupListeners");var b=document.getElementById(a.getController().getModel().getUID()+"__browsing").querySelector("select");b.addEventListener("change",function(b){var c=a.getSelectedOption(this),d=a.getClosest(c,"optgroup"),e=d.getAttribute("data-source");a.getController().getModel().setCurrentMediaSource(e,!1),a.getController().getModel().setCurrentDirectory(c.getAttribute("value"))})},a.prototype.assignViewButtonListeners=function(){function a(a){for(var b=document.querySelectorAll(".eureka__topbar-nav .view-btns a[data-view]"),c=0;c<b.length;c++){var d=b[c];d.classList.remove("current")}a.classList.add("current")}for(var b=this.getController().getModel(),c=document.querySelectorAll(".eureka__topbar-nav .view-btns a[data-view]"),d=0;d<c.length;d++){var e=c[d];e.addEventListener("click",function(c){c.preventDefault();for(var d=this,e=this.getAttribute("data-view"),f=["view-a","view-b","view-c","view-d"],g=0;g<f.length;g++){var h=f[g];document.getElementById(d.getAttribute("data-view-target")).classList.remove(h)}document.getElementById(d.getAttribute("data-view-target")).classList.add(e),a(d),b.setCurrentView(e)},!0)}},a.prototype.assignARIAKeyListeners=function(){var a=this;!function(){function b(b){for(var c=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),d=0;d<c.length;d++){var e=c[d];b!==e&&e.classList.contains("focused")&&e.classList.remove("focused")}b.classList.add("focused");var f=a.getProceedFooter().querySelector("button.cta");f.removeAttribute("disabled"),f.classList.remove("muted"),a.getController().getModel().setSelected(b.getAttribute("data-filename"))}function c(b){var c=document.getElementById("eureka_contextual__"+b.getAttribute("data-safe-filename"));c.focus(),a.getProceedFooter().querySelector("button.cta").classList.remove("go")}for(var d=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),e=0;e<d.length;e++){var f=d[e];f.addEventListener("focus",function(a){a.preventDefault(),b(this)},!1),f.addEventListener("blur",function(a){c(this)},!1)}}()},a.prototype.assignSortBtnListeners=function(){function a(a){a.preventDefault(),a.stopPropagation(),this.setAttribute("data-sort-asc",Math.abs(parseInt(this.getAttribute("data-sort-asc"))-1).toString());for(var c=this.getAttribute("data-sortby"),d="1"==this.getAttribute("data-sort-asc")?!0:!1,e=[],f=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),g=0;g<f.length;g++)e.push(f[g]);switch(c){case"dimensions":e.sort(function(a,b){return parseInt(a.getAttribute("data-dimensions-w"))*parseInt(a.getAttribute("data-dimensions-h"))-parseInt(b.getAttribute("data-dimensions-w"))*parseInt(b.getAttribute("data-dimensions-h"))});break;case"filesize":e.sort(function(a,b){return parseInt(a.getAttribute("data-filesize-bytes"))-parseInt(b.getAttribute("data-filesize-bytes"))});break;case"editedon":e.sort(function(a,b){return parseInt(a.getAttribute("data-timestamp"))-parseInt(b.getAttribute("data-timestamp"))});break;default:e.sort(function(a,b){return a.getAttribute("data-filename")>b.getAttribute("data-filename")?1:a.getAttribute("data-filename")<b.getAttribute("data-filename")?-1:0})}d||e.reverse();for(var h="",i=0;i<e.length;i++){var j=e[i];h+=j.outerHTML}b.getElement().querySelector(".eureka-table tbody").innerHTML=h}for(var b=this,c=document.querySelectorAll(".eureka-table th .fa-sort"),d=0;d<c.length;d++){var e=c[d];e.removeEventListener("click",a,!0),e.addEventListener("click",a,!0)}},a.prototype.assignFilterListeners=function(){function a(){for(var a=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),b=0;b<a.length;b++){var d=a[b];d.classList.remove("hidden")}document.getElementById(c.getController().getModel().getUID()).querySelector(".eureka-table > table > tbody").classList.remove("filtered")}function b(a){for(var b=c.getElement().querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),d=0;d<b.length;d++){var e=b[d],f=!1,g=[e.getAttribute("data-filename")];e.getAttribute("data-tokens")&&(g=g.concat(e.getAttribute("data-tokens").split("||"))),function(){for(var b=0;b<g.length;b++){var c=g[b];if(a.length&&(c==a||c.indexOf(a)>-1)){f=!0;break}}}(),f?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.add("hidden"),e.classList.remove("visible")),document.getElementById(c.getController().getModel().getUID()).querySelector(".eureka-table > table > tbody").classList.add("filtered")}}var c=this,d=document.getElementById("media-browser_0__filter-images");d.addEventListener("input",function(c){this.value?b(this.value):a()},!1)},a.prototype.populateTree=function(a){function b(a,c){for(var d=0;d<a.length;d++){var e=a[d],f=e.path.split("/");f=f.filter(function(a){return void 0!==a&&""!=a});var g=f.join("/"),h=document.createElement("li"),i=document.createElement("a");i.classList.add("folder");var j=document.createElement("i");j.classList.add("fa"),j.classList.add("icon"),j.classList.add("fa-folder"),j.classList.add("icon-folder"),j.classList.add("folder"),i.appendChild(j),i.innerHTML+="&nbsp;";var k=document.createElement("a");if(k.innerHTML=g,k.setAttribute("title","Browse "+e.path),k.setAttribute("data-cd",e.path),k.classList.add("path"),h.appendChild(i),h.appendChild(k),void 0!==e.children&&e.children.length){var l=document.createElement("ul");b(e.children,l),h.appendChild(l)}c.appendChild(h)}}a=JSON.parse(a);var c=a.results,d=document.querySelector("#media-browser_0__pathbrowser nav.tree > ul");this.emptyTree(),d.innerHTML="",b(c,d),this.assignTreeListeners()},a.prototype.getProceedFooter=function(){return this.getElement().parentNode.querySelector("footer.proceed")},a.prototype.handleTreePathClicked=function(a){function b(){for(var a=document.querySelectorAll("nav.tree a.path"),b=0;b<a.length;b++){var d=a[b],e=c.getClosest(d,"li");e.classList.remove("active")}}var c=this,d=c.getController().getModel().getCurrentMediaSource(),e=new AJAX;e.get(c.getController().getModel().getListDirectoryRequestURL(),{s:d,dir:a.getAttribute("data-cd"),headers:c.getController().getModel().getXHRHeaders()},function(a){c.paintJSON(a)});var f=c.getClosest(a,"li");b(),f.classList.add("active")},a.prototype.assignTreeListeners=function(){for(var a=this,b=document.querySelectorAll("nav.tree a.path"),c=0;c<b.length;c++){var d=b[c];d.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),a.handleTreePathClicked(this)})}this.assignTreeFolderListeners()},a.prototype.assignMediaBrowserOptGroupListeners=function(){var a=this;a.getController().getModel().getDebug()&&console.log("assignMediaBrowserOptGroupListeners");var b=a.getElement().querySelector("#"+a.getController().getModel().getUID()+"__browsing select");b.addEventListener("change",function(){var c=a.getSelectedOption(b);a.getController().getModel().setCurrentMediaSource(a.getClosest(c,"optgroup").getAttribute("data-source"));var d=new AJAX;d.get(a.getController().getModel().getListSourceRequestURL(),{s:a.getController().getModel().getCurrentMediaSource(),headers:a.getController().getModel().getXHRHeaders()},function(b){a.getController().getView().populateTree(b)})})},a.prototype.assignTreeFolderListeners=function(){for(var a=this,b=document.querySelectorAll("nav.tree a.folder"),c=0;c<b.length;c++){var d=b[c];d.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation();var c=this.querySelector(".fa"),d=c.classList.contains("fa-folder-open"),e=a.getClosest(this,"li");d?(c.classList.remove("fa-folder-open"),c.classList.remove("icon-folder-open"),c.classList.add("fa-folder"),c.classList.add("icon-folder"),e.classList.remove("open")):(c.classList.remove("fa-folder"),c.classList.remove("icon-folder"),c.classList.add("fa-folder-open"),c.classList.add("icon-folder-open"),e.classList.add("open"))})}},a.prototype.assignSelectListeners=function(){var a=this,b=a.getElement().querySelector("#"+a.getController().getModel().getUID()+"__mediasource-select");b.addEventListener("change",function(){a.getController().getModel().setCurrentMediaSource(this.value),a.getController().getModel().setCurrentDirectory(this.value,!1);var b=new AJAX;b.get(a.getController().getModel().getListSourceRequestURL(),{s:a.getController().getModel().getCurrentMediaSource(),headers:a.getController().getModel().getXHRHeaders()},function(b){a.getController().getView().populateTree(b)})})},a.prototype.emptyTree=function(){for(var a=document.querySelectorAll("nav.tree a.path"),b=0;b<a.length;b++){var c=a[b];c.removeEventListener("click"),c.remove()}},a.prototype.assignDraggableListeners=function(){for(var a=document.querySelectorAll('*[sorta-draggable="true"]'),b=0;b<a.length;b++){var c=a[b];c.addEventListener("blur",function(a){this.parentNode.draggable=!1}),c.addEventListener("focus",function(a){this.parentNode.draggable=!1})}},a.prototype.paint=function(){this.assignARIAKeyListeners(),this.assignContextualClickListeners(),this.assignDraggableListeners()},a.prototype.paintTree=function(a){function b(a,c){for(var d=0;d<a.length;d++){var e=a[d],f=document.createElement("li"),g=document.createElement("a");g.innerHTML="&nbsp;",g.classList.add("folder");var h=document.createElement("i");h.classList.add("fa"),h.classList.add("icon"),h.classList.add("fa-folder"),h.classList.add("icon-folder"),g.appendChild(h);var i=document.createElement("a");if(i.classList.add("path"),i.setAttribute("href","#"),i.setAttribute("title","Browse "+e.path),i.setAttribute("data-cd",e.path),i.innerHTML=" "+e.path,f.appendChild(g),f.appendChild(i),void 0!==e.children&&e.children.length){var j=document.createElement("ul");b(e.children,j),f.appendChild(j)}c.appendChild(f)}}a=JSON.parse(a);var c=this.getElement().querySelector("nav.tree"),d=a.results;c.innerHTML="";var e=document.createElement("ul");c.appendChild(e),b(d,e),this.assignTreeListeners()},a.prototype.paintJSON=function(a){function b(a){var b=document.createElement("code");return b.innerHTML=a,b}function c(){function a(){function a(){var a=document.createElement("a");a.classList.add("expand"),a.setAttribute("href",l),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-expand"),b.classList.add("icon-expand"),a.appendChild(b),a.innerHTML+=" Expand",a}function b(){var a=document.createElement("a");a.classList.add("choose"),a.setAttribute("href",l),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-check-circle-o"),b.classList.add("icon-check-circle-o"),a.appendChild(b),a.innerHTML+=" Choose",a}function c(){var a=document.createElement("a");a.classList.add("rename"),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-edit"),b.classList.add("icon-edit"),a.appendChild(b),a.innerHTML+=" Rename",a}function e(){var a=document.createElement("a");a.classList.add("dangerous"),a.classList.add("trash"),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-trash"),b.classList.add("icon-trash"),a.appendChild(b),a.innerHTML+=" Delete",a}var f=document.createElement("nav");return f.classList.add("flexible_row"),f.classList.add("contextual__nav"),f.appendChild(a()),f.appendChild(b()),d.getController().getModel().getEditable()&&document.execCommand&&f.appendChild(c()),d.getController().getModel().getEditable()&&f.appendChild(e()),f}var b=document.createElement("tr");b.classList.add("contextual"),b.setAttribute("id","eureka_contextual__"+k);var c=document.createElement("td");return c.setAttribute("colspan","4"),c.appendChild(a()),b.appendChild(c),b}var d=this;d.getController().getModel().getDebug()&&console.log("paintJSON"),a=JSON.parse(a);var e=this.getController().getModel();e.setCurrentMediaSource(a.cs,!1),e.setCurrentDirectory(a.cd,!1);for(var f=a.results,g="",h=0;h<f.length;h++){var i=f[h],j=i.filename,k=j.replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,""),l=i.src,m=i.filesize,n=i.dimensions,o=parseInt(i.editedon),p=document.createElement("tr");p.classList.add("eureka__row"),p.setAttribute("tabindex","0"),p.setAttribute("data-tokens",""),p.setAttribute("data-filename",j),p.setAttribute("data-safe-filename",k),p.setAttribute("data-dimensions-w",n.split("x")[0]),p.setAttribute("data-dimensions-h",n.split("x")[1]),p.setAttribute("data-filesize-bytes",m),p.setAttribute("data-timestamp",o.toString());var q=document.createElement("td");q.setAttribute("contenteditable","false"),q.classList.add("eureka__row-image");var r=document.createElement("div");r.classList.add("image");var s=document.createElement("img");s.setAttribute("src",l),r.appendChild(s);var t=document.createElement("code");t.setAttribute("contenteditable","true"),t.setAttribute("tabindex","-1"),t.setAttribute("sorta-draggable","true"),t.innerHTML=j,q.appendChild(r),q.appendChild(t);var u=document.createElement("td");u.classList.add("eureka__row-dimensions"),u.appendChild(b(n));var v=document.createElement("td");v.classList.add("eureka__row-filesize"),v.appendChild(b(d.formatFileSize(m)));var w=document.createElement("td");w.classList.add("eureka__row-editedon"),w.appendChild(b(new Date(1e3*o).toLocaleDateString(e.getLocale(),{month:"short",day:"numeric",year:"numeric"}))),p.appendChild(q),p.appendChild(u),p.appendChild(v),p.appendChild(w),g+=p.outerHTML,g+=c().outerHTML}document.querySelector("#media-browser_0 .eureka-table > table > tbody").innerHTML=g;try{this.getElement().querySelector("nav.tree li.active").classList.remove("active")}catch(a){}try{this.getElement().querySelector('nav.tree li > a[data-cd="'+a.cd+'"]').parentNode.classList.add("active")}catch(a){}try{this.getElement().querySelector(".pathbrowser__topbar > select").value=a.cs}catch(a){}this.paint()},a.prototype.assignContextualClickListeners=function(){function a(){function a(a){var b=d.getClosest(a,"tr"),c=b.previousSibling;d.getController().getModel().setChoosenMediaItem(c.getAttribute("data-filename"))}for(var b=d.getElement().querySelectorAll("tr.contextual a.choose"),c=0;c<b.length;c++){var e=b[c];e.addEventListener("click",function(b){b.preventDefault(),a(this)},!1),e.addEventListener("focus",function(a){d.getElement().parentNode.querySelector("footer.proceed .cta").classList.add("go"),d.getElement().parentNode.querySelector("footer.proceed .cta").disabled=!1,d.getElement().parentNode.querySelector("footer.proceed .cta").removeAttribute("disabled")},!1),e.addEventListener("blur",function(a){d.getElement().parentNode.querySelector("footer.proceed .cta").classList.remove("go")},!1),e.addEventListener("mouseover",function(a){d.getElement().parentNode.querySelector("footer.proceed .cta").classList.add("go")},!1),e.addEventListener("mouseout",function(a){d.getElement().parentNode.querySelector("footer.proceed .cta").classList.remove("go")},!1)}}function b(){function a(a){function b(a){try{a.remove()}catch(b){a.parentNode.removeChild(a)}}var c=d.getClosest(a,"tr"),e=c.previousSibling,f=c.nextSibling;d.getController().getModel().deleteFile(e.getAttribute("data-filename"),e),b(e),b(c);try{f.focus()}catch(a){}}function b(b){13===b.keyCode&&a(this)}for(var c=document.querySelectorAll("tr.contextual a.trash"),e=0;e<c.length;e++){var f=c[e];f.addEventListener("click",function(b){a(this)},!1),f.addEventListener("focus",function(a){this.addEventListener("keydown",b,!1)},!1),f.removeEventListener("blur",function(a){this.removeEventListener("keydown",b,!1)},!1)}}function c(){function a(a){{var e=c(this);d.getClosest(this,".contextual").previousSibling}13===a.keyCode&&(a.preventDefault(),a.stopPropagation(),b(e))}function b(a){a.focus();try{a.select()}catch(a){}}function c(a){var b=d.getClosest(a,"tr"),c=b.previousSibling,e=c.querySelector('.eureka__row-image code[contenteditable="true"]');return e}for(var e=document.querySelectorAll("tr.contextual a.rename"),f=0;f<e.length;f++){var g=e[f];g.addEventListener("click",function(a){a.preventDefault();var d=c(this);b(d)},!1),g.addEventListener("focus",function(b){this.addEventListener("keydown",a,!1)},!1),g.addEventListener("blur",function(b){this.removeEventListener("keydown",a,!1)},!1)}}var d=this;d.assignContexualCodeFocusListeners(),a(),c(),b()},a.prototype.assignContexualCodeFocusListeners=function(){function a(a){if(13===a.keyCode){a.preventDefault();var c=this.parentNode.parentNode,d=c.nextSibling,f=c.getAttribute("data-filename");e.contentEditable="false";var g=this.innerHTML;b.getController().getModel().renameFile(f,g);var h=d.querySelector("nav > a.rename");return h.focus(),window.getSelection().collapse(h,0),!1}return!0}for(var b=this,c=this.getElement().querySelectorAll('tr.eureka__row .eureka__row-image code[contenteditable="true"]'),d=0;d<c.length;d++){var e=c[d];e.addEventListener("focus",function(){this.addEventListener("keydown",a,!1)},!1)}},a.prototype.sortBrowseSelectOptGroupsByMediaSourceId=function(a){void 0===a&&(a=document.getElementById(this.getController().getModel().getUID()+"__browsing").querySelector("select"));for(var b=[],c=a.querySelectorAll("optgroup"),d=0;d<c.length;d++)b.push(c[d]);var e=b.sort(function(a,b){return parseInt(a.getAttribute("data-source"))-parseInt(b.getAttribute("data-source"))});a.innerHTML="";for(var f=0;f<e.length;f++){var g=e[f];a.appendChild(g)}},a.prototype.updateMediaSourceListings=function(a){function b(){d.getController().getModel().getDebug()&&console.log("updateTreeSelect");var b=document.getElementById(d.getController().getModel().getUID()+"__mediasource-select"),c=null;try{c=b.querySelector('option[value="'+e+'"]')}catch(a){}c||(c=document.createElement("option"),c.setAttribute("value",e),c.innerHTML=a.title,b.appendChild(c))}function c(){function b(a){for(var c=0;c<a.length;c++){var d=a[c],e=document.createElement("option");e.innerHTML=d.path,e.setAttribute("value",d.path),h.push(e),d.children&&d.children.length&&b(d.children)}}d.getController().getModel().getDebug()&&console.log("updateTopBarSelect");var c=document.getElementById(d.getController().getModel().getUID()+"__browsing").querySelector("select");d.getController().getModel().getDebug()&&console.log(c);var f=null;try{f=c.querySelector('optgroup[data-source="'+e+'"]')}catch(a){}f||(f=document.createElement("optgroup"),f.setAttribute("label",a.title),f.setAttribute("data-source",e));var g=a.results,h=[];b(g),f.innerHTML="";for(var i=0;i<h.length;i++){var j=h[i];f.appendChild(j)}c.appendChild(f),d.sortBrowseSelectOptGroupsByMediaSourceId(c)}var d=this;d.getController().getModel().getDebug()&&(console.log("updateMediaSourceListings: "),console.log(a)),a=JSON.parse(a);{var e=a.cs;this.getController().getModel().getMediaSourceDTOByID(e)}b(),c()},a.prototype.getSelectedOption=function(a){for(var b=a.querySelectorAll("option"),c=0;c<b.length;c++){var d=b[c];if(d.selected)return d}},a.prototype.formatFileSize=function(a){for(var b=[" Bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=1;c<b.length;c++)if(a<Math.pow(1024,c))return Math.round(a/Math.pow(1024,c-1)*100)/100+b[c-1];return a.toString()},a.prototype.getClosest=function(a,b){for(var c=b.charAt(0);a&&a!==document;a=a.parentNode){if("."===c&&a.classList.contains(b.substr(1)))return a;if("#"===c&&a.id===b.substr(1))return a;if("["===c&&a.hasAttribute(b.substr(1,b.length-2)))return a;if(a.tagName.toLowerCase()===b)return a}return null},a}(),EurekaController=function(){function a(a){this.opts=a,this._model=a.model,this._view=a.view}return a.prototype.getModel=function(){return this._model},a.prototype.getView=function(){return this._view},a.prototype.init=function(){var a=this,b=a.getView().getElement();b.addEventListener("eurekaViewChange",function(a){}),b.addEventListener("eurekaCurrentDirectoryChange",function(b){a.getModel().getDebug()&&console.log("eurekaCurrentDirectoryChange");var c=new AJAX;c.get(a.getModel().getListDirectoryRequestURL(),{s:a.getModel().getCurrentMediaSource(),dir:b.currentDirectory,headers:a.getModel().getXHRHeaders()},function(b){a.getModel().getDebug()&&console.log(b),a.getView().paintJSON(b)})}),b.addEventListener("eurekaMediaSourceChange",function(b){a.getModel().getDebug()&&console.log("eurekaMediaSourceChange");var c=new AJAX;c.get(a.getModel().getListSourceRequestURL(),{s:b.currentMediaSource,headers:a.getModel().getXHRHeaders()},function(b){a.getModel().getDebug()&&console.log(b),a.getView().paintTree(b),
a.getModel().setCurrentDirectory("")})}),b.addEventListener("MediaSourcesListChange",function(b){function c(b){a.getModel().getDebug()&&console.log("requestMediaListings");var c=b.getID(),d=new AJAX;d.get(a.getModel().getListSourceRequestURL(),{s:c,headers:a.getModel().getXHRHeaders()},function(b){a.getModel().getDebug()&&console.log(b),a.getView().updateMediaSourceListings(b)})}a.getModel().getDebug()&&console.log("MediaSourcesListChange: ");var d=b.detail.data;a.getModel().getDebug()&&console.log(b);for(var e=0;e<d.length;e++){{var f=new EurekaMediaSource(d[e].opts);f.getID()}c(f)}}),a.getModel().getDebug()&&console.log("MediaSourcesListChange listener added"),function(){a.getModel().getDebug()&&console.log("MediaSourcesListChange: ");var b=new AJAX;b.get(a.getModel().getListSourcesRequestURL(),{headers:a.getModel().getXHRHeaders()},function(b){a.getModel().getDebug()&&console.log(b),a.getModel().setMediaSourcesData(b)})}()},a}();